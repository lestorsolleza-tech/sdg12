<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - User Feedback</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }
        .welcome-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Authentication Check Script (must be at the top) -->
    <script>
        // Check if user is logged in
        if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            // Redirect to login page if not authenticated
            window.location.href = 'admin-login.html';
        }
    </script>

    <div class="admin-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2><strong>Admin Dashboard</strong></h2>
                    <p class="mb-0">User Feedback Management System</p>
                </div>
                <div>
                    <span class="me-3">Welcome, <strong id="admin-username"></strong></span>
                    <button class="btn btn-light btn-sm" id="logout-btn">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h4>üëã Welcome to the Admin Panel</h4>
            <p class="mb-0">Manage user feedback submissions from the SDG 12 Contact Form</p>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stats-card text-center">
                    <div class="stats-number" id="total-feedback">0</div>
                    <p class="text-muted mb-0">Total Feedback</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card text-center">
                    <div class="stats-number text-success" id="today-feedback">0</div>
                    <p class="text-muted mb-0">Today's Submissions</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card text-center">
                    <div class="stats-number text-info" id="this-week">0</div>
                    <p class="text-muted mb-0">This Week</p>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-between mb-3">
            <h3>Feedback Submissions</h3>
            <div>
                <button class="btn btn-success me-2" id="export-json">üì• Export JSON</button>
                <button class="btn btn-warning me-2" id="refresh-btn">üîÑ Refresh</button>
                <button class="btn btn-danger" id="clear-all">üóëÔ∏è Delete All</button>
            </div>
        </div>

        <!-- Feedback Table -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th style="width: 5%">#</th>
                                <th style="width: 15%">Name</th>
                                <th style="width: 20%">Email</th>
                                <th style="width: 35%">Message</th>
                                <th style="width: 15%">Date</th>
                                <th style="width: 10%">Action</th>
                            </tr>
                        </thead>
                        <tbody id="feedback-table">
                            <tr>
                                <td colspan="6" class="text-center text-muted">
                                    <em>No feedback submissions yet</em>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Back Link -->
        <div class="text-center mt-4">
            <a href="index.html" class="btn btn-outline-primary">‚Üê Back to Homepage</a>
        </div>
    </div>

    <script>
        // Display admin username
        document.getElementById('admin-username').textContent = 
            sessionStorage.getItem('adminUsername') || 'Admin';

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminUsername');
                window.location.href = 'admin-login.html';
            }
        });

        // Load feedback into table
        function loadFeedback() {
            const table = document.getElementById("feedback-table");
            table.innerHTML = "";

            const feedbackList = JSON.parse(localStorage.getItem("feedbackList")) || [];

            if (feedbackList.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            <em>No feedback submissions yet</em>
                        </td>
                    </tr>
                `;
                return;
            }

            feedbackList.forEach((item, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.name}</td>
                        <td>${item.email}</td>
                        <td>${item.message.substring(0, 100)}${item.message.length > 100 ? '...' : ''}</td>
                        <td><small>${item.date}</small></td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteFeedback(${index})">
                                Delete
                            </button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });

            // Update statistics
            updateStatistics(feedbackList);
        }

        // Update statistics
        function updateStatistics(feedbackList) {
            document.getElementById('total-feedback').textContent = feedbackList.length;

            const today = new Date().toDateString();
            const todayCount = feedbackList.filter(item => 
                new Date(item.date).toDateString() === today
            ).length;
            document.getElementById('today-feedback').textContent = todayCount;

            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const weekCount = feedbackList.filter(item => 
                new Date(item.date) >= oneWeekAgo
            ).length;
            document.getElementById('this-week').textContent = weekCount;
        }

        // Delete one feedback
        function deleteFeedback(index) {
            if (confirm('Are you sure you want to delete this feedback?')) {
                let list = JSON.parse(localStorage.getItem("feedbackList")) || [];
                list.splice(index, 1);
                localStorage.setItem("feedbackList", JSON.stringify(list));
                loadFeedback();
            }
        }

        // Delete ALL
        document.getElementById("clear-all").addEventListener("click", function () {
            if (confirm("‚ö†Ô∏è WARNING: This will permanently delete ALL feedback submissions. Are you sure?")) {
                if (confirm("This action cannot be undone. Click OK to confirm.")) {
                    localStorage.removeItem("feedbackList");
                    loadFeedback();
                    alert("‚úÖ All feedback has been deleted.");
                }
            }
        });

        // Refresh functionality
        document.getElementById('refresh-btn').addEventListener('click', function() {
            loadFeedback();
            alert('‚úÖ Data refreshed successfully!');
        });

        // Export to JSON
        document.getElementById('export-json').addEventListener('click', function() {
            const feedbackList = JSON.parse(localStorage.getItem("feedbackList")) || [];
            
            if (feedbackList.length === 0) {
                alert("No feedback to export!");
                return;
            }

            const dataStr = JSON.stringify(feedbackList, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = `feedback-export-${new Date().toISOString().split('T')[0]}.json`;
            a.click();

            URL.revokeObjectURL(url);
            alert("‚úÖ Feedback exported successfully!");
        });

        // Initial load
        loadFeedback();
    </script>
</body>
</html>
